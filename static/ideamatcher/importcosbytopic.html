
<!DOCTYPE html>
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Force and rings network visualizations of LDA Models</title>
  <script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>

  <!-- <link rel="stylesheet/less" type="text/css" href="styles/style.less" />
 --><!-- 
  <script src="js/lib/less-1.7.0.min.js" type="text/javascript"></script>  
-->

<script src="d3.js"></script>
<script src="d3plus.js"></script> 

<script type="text/javascript">
  $(function() {
   var rawdat=$.get( "crunchbase-topic_cut.txt", function( data ) {

     $( "#in" ).html( data.trim());
     $("#sub").click()
   });


   $("#sub").click(function() {

     var rawdat=$("#in").val().trim();

    // #doc source pos typeindex type topic
    // 0 output/crunchbase/glumobilemedia 0 0 glu 28
    // 0 output/crunchbase/glumobilemedia 1 1 mobile 40
    
    var rawLinesRay=rawdat.split("\n")
    var lines=[]

    var topics={}
    var cos={}

    var nodes_d={}

    var linksD={}
    var links=[]

    // #doc source pos typeindex type topic
    for(var i=0; i<rawLinesRay.length;i++) {
      var rawLineRay=rawLinesRay[i].split(" ");
      
      var pid=rawLineRay[0]+""+rawLineRay[2]
      
      var line={pid:pid, color:"#00FF00", coid:rawLineRay[0],title:rawLineRay[1].substr("output/crunchbase/".length), typeindex:rawLineRay[3], type:rawLineRay[4], topic:rawLineRay[5]}



      if(!(line.topic in topics)) {
        var topicObj={coid:"9999"+line.topic, color:"#FF0000", title:"#"+line.type, typeindex:line["typeindex"], type:line["type"], topic:line.topic,isTopic:true}
        topicObj['pid']=topicObj['coid']
        topics[line.topic]=topicObj;
        nodes_d[topicObj['coid']]=topicObj
        console.log(nodes_d[topicObj['coid']])

        //lines.push(topicObj);
      }
      
      if(!(line.coid in cos)) {

        cos[line.coid]=line;
        
        linksD[line['coid']]={};


        //lines.push(topicObj);
      }

      nodes_d[line['coid']]=line

      if((linksD[line['coid']]["9999"+line.topic] === undefined)) {
        linksD[line['coid']]["9999"+line.topic]=true
        var link={source:line['coid'], target:"9999"+line.topic, value:0}

        links.push(link);

          //lines.push(topicObj);
        }
      }      



      console.log("lines",rawLinesRay.length)
      console.log("links",links)
      console.log("topics",topics)
      console.log("nodes_d",nodes_d)


      var relations_orig=links;
  //{prim_key:436, source:1106, target:1213, value:0, time:1402333770, uid:null, mapid:0,…}
  var relations=[];

  var nodes_orig=Object.keys(nodes_d).map(function(key){
    return nodes_d[key];
}); //lines;
  //{pid:1608, time:1404922870, title:#test, body:#test, status:0, progress:, metric:, uid:0, parent:0,…}


  var nodes=[];
  var sample_data = [
  {"prim_key":"778", "name": "alpha", "size": 10},
  {"prim_key":"781", "name": "beta", "size": 12},
  {"prim_key":"3", "name": "gamma", "size": 30},
  {"prim_key":"4", "name": "delta", "size": 26},
  {"prim_key":"5", "name": "epsilon", "size": 12},

  ]

  for(i=0;i<relations_orig.length;i++) {
    if(isNaN (relations_orig[i]['source']) ||isNaN(relations_orig[i]['target']) )
    {
      console.log("nan")
      continue;
    }
    relations[i]={};
    relations[i]['source']=relations_orig[i]['source']
    relations[i]['target']=relations_orig[i]['target']
      // relations[i]['strength']=relations_orig[i]['strength']

    // console.log(relations[i]['source'],relations[i]['target'])
    //   relations[i]['source']=relations_orig[i]['source']['prim_key']
    //   relations[i]['target']=relations_orig[i]['target']['prim_key']
  }

  for(i=0;i<nodes_orig.length;i++) {

    if(nodes_orig[i]===undefined||nodes_orig[i]['title']===undefined || nodes_orig[i]['pid']===undefined) {
      console.log("nodebad",nodes_orig[i]['pid'])
      continue
    }

    nodes[i]={};
    nodes[i]['title']=nodes_orig[i]['title'];
    nodes[i]['name']=nodes_orig[i]['title'];
    nodes[i]['body']=nodes_orig[i]['body'];
    nodes[i]['coid']=nodes_orig[i]['coid'];
    nodes[i]['pid']=nodes_orig[i]['pid'];
    nodes[i]['color']=nodes_orig[i]['color'];
    nodes[i]['size']=5;

  }
    // nodes[nodes.length]={'title':"Main",'coid':888,'size':5}
    // relations[relations.length]={source:888,target:888}

 var relationsf=relations //.slice(0,3)

 console.log(relations[0]['source'],relations[0]['target'])


 // var rvisualization = d3plus.viz()
 //    .container("#rviz")  // container DIV to hold the visualization
 //    .type("rings")
 //    .data(nodes)      // visualization type
 //    .edges(relationsf) // list of node connections
 //    .focus(relationsf[0]['source'])
 //    .id("pid")
 //    .text("title")
 //    .tooltip("body")     // ID of the initial center node
 //    .draw()             // finally, draw the visualization!
 var stats="<ul>"
 stats+="<li>lines <span class='val'>"+rawLinesRay.length+"</span></li>"
 stats+="<li>links <span class='val'>"+links.length+"</span></li>"
 stats+="<li>topics <span class='val'>"+Object.keys(topics).length+"</span></li>"
 stats+="<li>nodes_d <span class='val'>"+Object.keys(nodes_d).length+"</span></li>"
 stats+="</ul>"

 $('#stats').html(stats)


 $('#nodesout').val(JSON.stringify(nodes_orig))

 $('#nodesout').before("<span>("+nodes_orig.length+")</span>")
 $('#relsout').val(JSON.stringify(relationsf))
 $('#relsout').before("<span>("+relationsf.length+")</span>")


 var visualization = d3plus.viz()
 .container("#nviz")
 .type("network")
 .data(nodes)
 .edges(relationsf)
 .size("size")
 .id("coid")
 .text("title")
 .color("color")
 .tooltip("body")
 .draw();


 var visualization2 = d3plus.viz()
 .container("#rviz")
 .type("rings")
 .data(nodes)
 .edges(relationsf)
 .size("size")
 .id("coid")
 .text("title")
 .color("color")
 .focus(nodes[0]["coid"])
 .draw()

})






})
</script>

<style type="text/css">
  #sub {
    width:100px;
    height: 20px;
    float:left;
  }
  #in {
    width:500px;
    height: 350px;
  }
  .box {
    margin: 10px;
    padding: 5px;
    border:1px solid #AAA;
  }  

  .row > * {
    display: inline-block;
    vertical-align: bottom;
  }
  .label {
    margin-bottom: 5px;
  }
  div {

  }
  textarea {
   margin-left: 10px 
 }
 ul {
  margin-top: 0px
}

.graph {
  height: 600px;
}

</style>
</head>
<body>

  <div class="container-fluid outermost" > 

<h3>Force and rings network visualizations of LDA Models</h3> 
<a href="crunchbase-topic.txt" target="_blank">More Data</a>
    <div class="row">
      <div class="box">
        <div class="label">Input</div>
        <textarea id="in"></textarea>
        <button id="sub">Submit</button>
      </div>

      <div class="box"><div class="label">Stats </div><div id="stats"></div></div>
      <div class="box"><div class="label">Nodes</div><textarea id="nodesout" readonly></textarea></div> 
      <div class="box"><div class="label">Edges</div><textarea id="relsout" readonly></textarea></div
      <div id="view">
      </div>

  <div class="box"><div class="label">Force directed graph </div><div id="nviz" class = " graph"></div></div>
  <div class="box"><div class="label">Rings visualization </div><div id="rviz" class = " graph"></div></div>

</div>

</div>

</body>
</html>
